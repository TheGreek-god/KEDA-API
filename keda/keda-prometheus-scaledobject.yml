
# apiVersion: keda.k8s.io/v1alpha1
# kind: ScaledObject
# metadata:
#   name: myidentity-scaledobject
#   namespace: api-app
#   labels:
#     deploymentName: myidentity-api
# spec:
#   scaleTargetRef:
#     deploymentName: myidentity-api
#   pollingInterval: 30  # Optional. Default: 30 seconds
#   cooldownPeriod:  15 # Optional. Default: 300 seconds
#   minReplicaCount: 1   # Optional. Default: 0
#   maxReplicaCount: 10 # Optional. Default: 100
#   triggers:
#   - type: prometheus
#     metadata:
#       # Required
#       serverAddress: http://prometheus-service.monitoring.svc.cluster.local:9090
#       metricName: access_frequency
#       threshold: '50'
#       query: sum(rate(node_http_requests_total[2m]))

apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: myidentity-scaledobject
  namespace: api-app  # ‚Üê CHANGE FROM 'keda' TO 'api-app'
spec:
  scaleTargetRef:
    name: myidentity-api
    kind: Deployment
  pollingInterval: 30
  cooldownPeriod: 15
  minReplicaCount: 1
  maxReplicaCount: 10
  triggers:
  - type: prometheus
    metadata:
      serverAddress: http://prometheus-service.monitoring.svc.cluster.local:9090
      metricName: access_frequency
      threshold: '50'
      # query: sum(rate(node_http_requests_total{app="myidentity-api"}[2m]))
      query: sum(rate(node_http_requests_total[2m]))